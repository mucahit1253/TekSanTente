@model ProductDetailVm
@using System.Globalization

@{
    var ci = new CultureInfo("tr-TR");

    // Null-güvenli fiyat metni
    string priceText = Model.Product.Price.HasValue
        ? Model.Product.Price.Value.ToString("C0", ci)   // Örn: ₺12.345
        : "Fiyat için arayın";

    // Null-güvenli görsel listesi
    var images = Model.Images ?? Enumerable.Empty<ProductImage>();
}

<main class="main">
    <!-- Page Title -->
    <div class="page-title" data-aos="fade">
        <div class="heading">
            <div class="container">
                <div class="row d-flex justify-content-center text-center">
                    <div class="col-lg-8">
                        <h1>@Model.Product.Name</h1>
                    </div>
                </div>
            </div>
        </div>
        <nav class="breadcrumbs">
            <div class="container">
                <ol>
                    <li><a asp-controller="Home" asp-action="index">Ana Menü</a></li>
                    <li class="current">@Model.Product.Name</li>
                </ol>
            </div>
        </nav>
    </div><!-- End Page Title -->
    <!-- Real Estate 2 Section -->
    <section id="real-estate-2" class="real-estate-2 section">
        <div class="container" data-aos="fade-up">

            <div class="portfolio-details-slider swiper init-swiper">
                <script type="application/json" class="swiper-config">
                    {
                      "loop": true,
                      "speed": 600,
                      "autoplay": { "delay": 5000 },
                      "slidesPerView": "auto",
                      "navigation": { "nextEl": ".swiper-button-next", "prevEl": ".swiper-button-prev" },
                      "pagination": { "el": ".swiper-pagination", "type": "bullets", "clickable": true }
                    }
                </script>

                <div class="swiper-wrapper align-items-center">
                    @foreach (var img in images)
                    {
                        var raw = img?.Media?.Url;
                        var normalized = string.IsNullOrWhiteSpace(raw) ? "~/assets/img/placeholder.png"
                        : (raw!.StartsWith("~/") || raw.StartsWith("/")) ? raw
                        : "~/" + raw.TrimStart('/');

                        var src = Url.Content(normalized);
                        <div class="swiper-slide">
                            <img src="@src" alt="@Model.Product.Name"
                                style="width:100%; height:720px; object-fit:cover;" />
                        </div>
                    }
                </div>

                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-pagination"></div>
            </div>

            <div class="row justify-content-between gy-4 mt-4">
                <div class="col-lg-8" data-aos="fade-up">
                    <div class="portfolio-description">
                        <p>@Model.Product.Comment</p>
                    </div>
                </div>

                <div class="col-lg-3" data-aos="fade-up" data-aos-delay="100">
                    <div class="portfolio-info">
                        <h3>Hızlı Özet</h3>
                        <ul>
                            <li><strong>Ürün Adı</strong> @Model.Product.Name</li>
                            <li><strong>Alan</strong> <span>m<sup>2</sup></span></li>
                            <li><strong>Fiyatı</strong> @priceText</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

        @await Component.InvokeAsync("ProductFooterGet")
    </section>
    </main>